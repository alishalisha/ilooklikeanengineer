MEME.WebcamView=Backbone.View.extend({initialize:function(e){this.canvas=e.canvas,this.polyfillBrowser(),navigator.getUserMedia||$(".m-webcam").hide()},polyfillBrowser:function(){HTMLVideoElement.prototype.srcObject||Object.defineProperty(HTMLVideoElement.prototype,"srcObject",{get:function(){return this.mozSrcObject||this._srcObject},set:function(e){this.mozSrcObject?this.mozSrcObject=e:(this._srcObject=e,this.src=URL.createObjectURL(e))}}),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia},events:{"click #use-webcam":"startWebcam","click #take-snapshot":"takeSnapshot"},startWebcam:function(){if(navigator.getUserMedia){var e=MEME.$("#webcam-view video")[0],t=this.model,i=this.canvas;navigator.getUserMedia({video:!0,audio:!1},function(a){e.srcObject=a;var s=function(){e.videoHeight&&!e.height&&(e.height=e.videoHeight,e.width=e.videoWidth,t.background=e),t.get("snapshot")||i.render(),setTimeout(s,50)};e.onplay=s,MEME.$("#use-webcam, .dropzone").addClass("hide"),MEME.$("#take-snapshot").removeClass("hide")},function(e){console.err("Error getting webcam stream",e)})}},takeSnapshot:function(){var e=!this.model.get("snapshot");MEME.$("#take-snapshot").text(e?"Let's try again":"Take a snapshot"),this.model.set("snapshot",e)}});